!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],t):t(e.geov=e.geov||{},e.THREE)}(this,function(e,t){"use strict";var i=i=function(e,i,n){var o=3.141592653589793,r=2*o,a=this,h=-1,s=0,d=1,c=2;this.object=e,this.domElement=void 0!==i?i:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1,this.panSpeed=1,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.dynamicDampingFactor=.2,n=n||{},this.earthRadius=void 0!==n.radius?n.radius:6371,this.coord=void 0!==n.coord?new t.Vector2(n.coord[0],n.coord[1]):new t.Vector2(0,1.5707963267948966),this.zoom=void 0!==n.zoom?n.zoom:10,this.pitch=void 0!==n.pitch?n.pitch:0,this.bearing=void 0!==n.bearing?n.bearing:0,this.coordEnd=this.coord.clone(),this.zoomEnd=this.zoom,this.pitchEnd=this.pitch,this.bearingEnd=this.bearing,this.minZoom=void 0!==n.minZoom?n.minZoom:1,this.maxZoom=void 0!==n.maxZoom?n.maxZoom:18,this.globeZoom=10,this.maxPitch=80;var m=h,u=new t.Vector2,l=new t.Vector2,p={type:"change"},v=function(e){("end"!==e||p.type)&&(p.type=e,a.dispatchEvent(p),"end"===e&&(p.type=null))};this.jumpTo=function(e){validateOptions(e),this.coordEnd=void 0!==e.coord?new t.Vector2(e.coord[0],e.coord[1]):a.coordEnd,this.zoomEnd=void 0!==e.zoom?e.zoom:a.zoomEnd,this.pitchEnd=void 0!==e.pitch?e.pitch:a.pitchEnd,this.bearingEnd=void 0!==e.bearing?e.bearing:a.bearingEnd},this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}};var y=function(){var e=new t.Vector2;return function(t,i){return e.set((t-a.screen.left)/a.screen.width,(i-a.screen.top)/a.screen.height),e}}(),f=function(e){!1!==a.enabled&&(e.preventDefault(),e.stopPropagation(),m===h&&(m=e.button),(m===s&&!a.noRotate||m===d&&!a.noZoom||m===c&&!a.noPan)&&(l.copy(y(e.pageX,e.pageY)),u.copy(l)),document.addEventListener("mousemove",g,!1),document.addEventListener("mouseup",w,!1))},g=function(e){if(!1!==a.enabled){e.preventDefault(),e.stopPropagation(),l.copy(y(e.pageX,e.pageY));var i=l.clone().sub(u);if(u.copy(l),m!==s||a.noRotate)m!==d||a.noZoom?m!==c||a.noPan||(a.zoom<a.globeZoom?(Math.abs(i.y)>.05&&Math.abs(i.x)>.05||Math.abs(i.y)<Math.abs(i.x))&&(l.y<.5?a.bearingEnd=a.bearing+i.x*a.panSpeed*24:a.bearingEnd=a.bearing-i.x*a.panSpeed*24):a.bearingEnd=0,(Math.abs(i.y)>.05&&Math.abs(i.x)>.05||Math.abs(i.x)<Math.abs(i.y))&&(a.pitchEnd=t.Math.clamp(a.pitch-i.y*a.panSpeed*320,0,a.maxPitch))):(a.zoomEnd=t.Math.clamp(a.zoom+i.y*a.zoomSpeed*32,a.minZoom,a.maxZoom),a.zoomEnd>a.globeZoom&&(a.bearingEnd=0));else{Math.abs(i.y)<.01&&Math.abs(i.x)>.02&&(i.y=0),Math.abs(i.x)<.01&&Math.abs(i.y)>.02&&(i.x=0);var n=function(e){var i=Math.pow(2,a.zoom-1)*a.rotateSpeed*1e-4;return e.clone().rotateAround(new t.Vector2(0,0),-a.bearing).multiplyScalar(i)}(i);a.coordEnd.x=a.coord.x-n.x,a.coordEnd.y=t.Math.clamp(a.coord.y-n.y,0,o)}}},w=function(e){!1!==a.enabled&&(e.preventDefault(),e.stopPropagation(),m=h,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",w))},_=function(e){if(!1!==a.enabled){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:a.zoomEnd=t.Math.clamp(a.zoom+.025*e.deltaY*a.zoomSpeed*32,a.minZoom,a.maxZoom);break;case 1:a.zoomEnd=t.Math.clamp(a.zoom+.01*e.deltaY*a.zoomSpeed*32,a.minZoom,a.maxZoom);break;default:a.zoomEnd=t.Math.clamp(a.zoom+25e-5*e.deltaY*a.zoomSpeed*32,a.minZoom,a.maxZoom)}a.zoomEnd>a.globeZoom&&(a.bearingEnd=0)}},b=function(e){!1!==a.enabled&&e.preventDefault()};this.dispose=function(){this.domElement.removeEventListener("contextmenu",b,!1),this.domElement.removeEventListener("mousedown",f,!1),this.domElement.removeEventListener("wheel",_,!1),document.removeEventListener("mousemove",g,!1),document.removeEventListener("mouseup",w,!1)},this.domElement.addEventListener("contextmenu",b,!1),this.domElement.addEventListener("mousedown",f,!1),this.domElement.addEventListener("wheel",_,!1),this.handleResize(),this.update=function(){var e=a.dynamicDampingFactor,i=a.coordEnd.clone().sub(a.coord),n=a.zoomEnd-a.zoom,h=a.bearingEnd-a.bearing,s=a.pitchEnd-a.pitch;if(Math.abs(i.x)>1e-6||Math.abs(i.y)>1e-6||Math.abs(n)>1e-6||Math.abs(h)>1e-6||Math.abs(s)>1e-6)a.coord.x+=i.x*e,a.coord.y+=i.y*e,a.zoom+=n*e,a.bearing+=h*e,a.pitch+=s*e,a.needsUpdate=!0;else{for(;a.coordEnd.x<0;)a.coordEnd.x+=r;for(a.coordEnd.x=a.coordEnd.x%r,a.coord.copy(a.coordEnd),a.zoom=a.zoomEnd;a.bearingEnd<0;)a.bearingEnd+=r;a.bearing=a.bearingEnd=a.bearingEnd%r,a.pitch=a.pitchEnd}if(a.needsUpdate){var d=new t.Spherical(a.earthRadius,a.coord.y,a.coord.x);d.makeSafe();var c=(new t.Vector3).setFromSpherical(d),m=function(e){var i=Math.pow(1.71,a.zoom-1)*a.earthRadius*1e-4,n=(new t.Vector3).setFromSpherical(e);e.phi-=1e-6;var r=(new t.Vector3).setFromSpherical(e).sub(n).normalize();r.applyAxisAngle(n.clone().normalize(),a.bearing+o),a.pitch<1e-6&&(a.pitch=1e-6);return n.normalize().multiplyScalar(Math.tan((90-a.pitch)/180*o)).clone().add(r).normalize().multiplyScalar(i)}(d);a.object.position.copy(c.clone().add(m)),a.pitch<1e-6&&(a.pitch=1e-6);var u=c.clone().normalize().multiplyScalar(m.length()/Math.cos(a.pitch/180*o));a.object.up=u.sub(m).normalize(),a.object.lookAt(c),v("change"),a.needsUpdate=!1}else v("end")},this.needsUpdate=!0,this.update()};i.prototype=Object.create(t.EventDispatcher.prototype);var n=i;function o(e){return"number"==typeof e&&!isNaN(e)}var r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h=function(){function e(t,i){r(this,e),o(t)&&o(i)?(this.width=t,this.height=i):o(t.width)?(this.width=t.width,this.height=t.height):Array.isArray(t)&&(this.width=t[0],this.height=t[1])}return a(e,[{key:"copy",value:function(){return new e(this.width,this.height)}},{key:"add",value:function(t,i){var n=void 0,o=void 0;return t instanceof e?(n=this.width+t.width,o=this.height+t.height):(n=this.width+t,o=this.height+i),new e(n,o)}},{key:"equals",value:function(e){return this.width===e.width&&this.height===e.height}},{key:"multi",value:function(t){return new e(this.width*t,this.height*t)}},{key:"_multi",value:function(e){return this.width*=e,this.height*=e,this}},{key:"_round",value:function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this}},{key:"toArray",value:function(){return[this.width,this.height]}},{key:"toJSON",value:function(){return{width:this.width,height:this.height}}}]),e}(),s=function(){function e(t,i){if(r(this,e),t&&i?(this.x=+t,this.y=+i):Array.isArray(t)?(this.x=+t[0],this.y=+t[1]):t.x&&t.y&&(this.x=+t.x,this.y=+t.y),this._isNaN())throw new Error("coordinate is NaN")}return a(e,[{key:"copy",value:function(){return new e(this.x,this.y)}},{key:"equals",value:function(t){return t instanceof e&&(this.x===t.x&&this.y===t.y)}},{key:"_isNaN",value:function(){return isNaN(this.x)||isNaN(this.y)}},{key:"toArray",value:function(){return[this.x,this.y]}},{key:"toFixed",value:function(t){return new e(this.x.toFixed(t),this.y.toFixed(t))}},{key:"toJSON",value:function(){return{x:this.x,y:this.y}}}]),e}(),d=navigator.userAgent.toLowerCase(),c=document.documentElement,m="ActiveXObject"in window,u=-1!==d.indexOf("webkit"),l=-1!==d.indexOf("phantom"),p=-1!==d.search("android [23]"),v=-1!==d.indexOf("chrome"),y=-1!==d.indexOf("gecko")&&!u&&!window.opera&&!m,f="undefined"!=typeof orientation||-1!==d.indexOf("mobile"),g=!window.PointerEvent&&window.MSPointerEvent,w=window.PointerEvent&&navigator.pointerEnabled||g,_=m&&"transition"in c.style,b="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!p,E="MozPerspective"in c.style,x="OTransition"in c.style,M=(_||b||E)&&!x&&!l,L=0;v&&(L=d.match(/chrome\/([\d.]+)/)[1]);var z=!l&&(w||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),S=void 0;try{var k=document.createElement("canvas"),P=k.getContext("webgl")||k.getContext("experimental-webgl");S=P&&P instanceof WebGLRenderingContext}catch(e){S=!1}var R={ie:m,ielt9:m&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:u,gecko:y,android:-1!==d.indexOf("android"),android23:p,chrome:v,chromeVersion:L,safari:!v&&-1!==d.indexOf("safari"),phantomjs:l,ie3d:_,webkit3d:b,gecko3d:E,opera12:x,any3d:M,mobile:f,mobileWebkit:f&&u,mobileWebkit3d:f&&b,mobileOpera:f&&window.opera,mobileGecko:f&&y,touch:!!z,msPointer:!!g,pointer:!!w,retina:(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:m&&9===document.documentMode,ie10:m&&10===document.documentMode,webgl:S},I="varying vec3 vNormal;void main(){vNormal=normalize(normalMatrix*normal);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",Z="varying vec3 vNormal;void main(){float intensity=pow(1.32-dot(vNormal,vec3(0,0,1.0)),8.0);if(intensity>12.0)intensity=intensity*0.06;else if(intensity>3.0)intensity=9.0/intensity;gl_FragColor=vec4(0.3,0.5,1.0,0.3)*intensity;}",O=function(){function e(i){if(r(this,e),!i.earth)throw new Error("Can not build a Universe without Earth.");this.earth=i.earth,this._comps=new t.Group;var n=this;i.galaxyURL&&(n.galaxy=new t.Mesh,n.galaxy.geometry=new t.SphereGeometry(10*n.earth._radius,20,20),n.galaxy.material=new t.MeshBasicMaterial({side:t.BackSide}),(new t.TextureLoader).load(i.galaxyURL,function(e){e.anisotropy=16,e.wrapS=e.wrapT=t.RepeatWrapping,n.galaxy.material.map=e,n._comps.add(n.galaxy)})),i.atmosphereURL&&(n.atmosphere=new t.Mesh,n.atmosphere.geometry=new t.SphereGeometry(1.032*n.earth._radius,50,50),n.atmosphere.rotation.y=3,n.atmosphere.material=new t.MeshPhongMaterial({transparent:!0}),(new t.TextureLoader).load(i.atmosphereURL,function(e){e.anisotropy=16,e.wrapS=e.wrapT=t.RepeatWrapping,n.atmosphere.material.map=e,n.atmosphere.material.needsUpdate=!0,n.atmosphere.renderOrder=10,n._comps.add(n.atmosphere)})),i.aurora&&(n.aurora=new t.Mesh,n.aurora.geometry=new t.SphereGeometry(1.036*n.earth._radius,130,130),n.aurora.material=new t.ShaderMaterial({uniforms:{},vertexShader:I,fragmentShader:Z,side:t.BackSide,blending:t.AdditiveBlending,transparent:!0}),n._comps.add(n.aurora)),this.earth._scene.add(this._comps)}return a(e,[{key:"update",value:function(e){if(this.atmosphere){var t=.09*(e.zoom-13);t<.1&&this.atmosphere.material.opacity>=.1?this._comps.remove(this.atmosphere):t>=.1&&this.atmosphere.material.opacity<.1&&this._comps.add(this.atmosphere),this.atmosphere.material.opacity=t,this.atmosphere.rotation.y+=2e-5,this.atmosphere.rotation.x-=4e-5}}}]),e}(),C=function(){function e(t){r(this,e),this.setId(t)}return a(e,[{key:"getId",value:function(){return this._id}},{key:"setId",value:function(e){return e&&(e+=""),this._id=e,this}},{key:"addTo",value:function(e){return e.addLayer(this),this}},{key:"remove",value:function(){return this.earth&&this.earth.removeLayer(this),this}},{key:"setZIndex",value:function(e){return this._zIndex=e,this.earth,this}},{key:"getZIndex",value:function(){return this._zIndex}},{key:"_bindEarth",value:function(e,t){e&&(this.earth=e,this.setZIndex(t))}},{key:"getEarth",value:function(){return this.earth?this.earth:null}},{key:"load",value:function(){}},{key:"update",value:function(){}}]),e}();var D=637100,A=function(){function e(i,n){if(r(this,e),!n)throw new Error("Invalid options when creating earth.");var o=n.zoom?n.zoom:1,a=n.maxZoom?n.maxZoom:19,h=n.minZoom?n.minZoom:1,d=new s(n.center?n.center:[100,30]),c=n.layers,m=n.easyLayer;this._radius=D,this._loaded=!1,this._layers=[],this._zoomLevel=a-o,this._maxLevel=a,this._minLevel=h,this._center=d,this._initContainer(i),this._initRenderer(),this._updateEarthSize(this._getContainerDomSize()),this._universe=new O({earth:this,galaxyURL:void 0!=n.galaxy?n.galaxy:"textures/galaxy_starfield.png",atmosphereURL:void 0!=n.atmosphere?n.atmosphere:"textures/fair_clouds_4k.png",aurora:void 0==n.aurora||n.aurora}),m&&this.addLayer(function(e){var i=new C("easy-layer");return i.load=function(){var n=new t.Mesh;n.geometry=new t.SphereGeometry(i.earth._radius,120,120),n.material=new t.MeshPhongMaterial({bumpScale:.5,specular:new t.Color("grey"),shininess:10}),n.rotation.y=3;var o=new t.TextureLoader;o.load(e.baseURL,function(r){r.anisotropy=16,r.wrapS=r.wrapT=t.RepeatWrapping,n.material.map=r,o.load(e.bumpURL,function(e){e.anisotropy=16,e.wrapS=e.wrapT=t.RepeatWrapping,n.material.bumpMap=e,i.earth._scene.add(n)})})},i}({baseURL:void 0!=n.baseURL?n.baseURL:"textures/2_no_clouds_4k.jpg",bumpURL:void 0!=n.bumpURL?n.bumpURL:"textures/elev_bump_4k.jpg"})),c&&this.addLayer(c),this._load()}return a(e,[{key:"_initContainer",value:function(e){if((t=e)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)){if(this._containerDOM=document.getElementById(e),!this._containerDOM)throw new Error("Invalid container when creating earth: '"+e+"'")}else this._containerDOM=e;var t;if(this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&"geov-wrapper"===this._containerDOM.childNodes[0].className)throw new Error("Container is already loaded with another earth instance, use earth.remove() to clear it.");this._containerDOM.innerHTML="",this._containerDOM.appendChild(this._infoElem=document.createElement("div")),this._infoElem.className="geov-info-msg",this._containerDOM.appendChild(this._toolTipElem=document.createElement("div")),this._toolTipElem.className="geov-tooltip"}},{key:"_initRenderer",value:function(){this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=null),this._renderer=new t.WebGLRenderer({antialias:!0}),this._renderer.shadowMap.enabled=!0,this._renderer.setClearColor(0),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.domElement.className+="geov-wrapper",this._containerDOM.appendChild(this._renderer.domElement),this._scene=new t.Scene,this._camera=new t.PerspectiveCamera,this._camera.near=10,this._camera.far=100*this._radius,this._camera.add(new t.PointLight(16777215,1,this._radius)),this._scene.add(new t.AmbientLight(13421772)),this._controls=new n(this._camera,this._renderer.domElement,{maxZoom:this._maxLevel,minZoom:this._minLevel,zoom:this._zoomLevel,radius:this._radius}),this._earth=new t.Mesh,this._earth.geometry=new t.SphereGeometry(.97*this._radius,100,100),this._earth.material=new t.MeshBasicMaterial({color:5592405}),this._earth.renderOrder=20,this._scene.add(this._earth);var e=this;this._rafId=requestAnimationFrame(function t(){e._layers.forEach(function(e){e.update()}),e._controls.update(),e._universe.update(e._controls),e._renderer.render(e._scene,e._camera),requestAnimationFrame(t)})}},{key:"_updateEarthSize",value:function(e){return this.width=e.width,this.height=e.height,this._renderer.setSize(this.width,this.height),this._camera.aspect=this.width/this.height,this._camera.updateProjectionMatrix(),this._controls.handleResize(),this}},{key:"_getContainerDomSize",value:function(){if(!this._containerDOM)return null;var e=this._containerDOM,t=void 0,i=void 0;if(e.width&&e.height)t=e.width,i=e.height,R.retina&&(t/=2,i/=2);else{if(!e.clientWidth||!e.clientHeight)throw new Error("can not get size of container");t=parseInt(e.clientWidth,0),i=parseInt(e.clientHeight,0)}return new h(t,i)}},{key:"addLayer",value:function(e){if(!e)return this;if(!Array.isArray(e))return this.addLayer([e]);this._layerCache||(this._layerCache={});for(var t=0,i=e.length;t<i;t++){var n=e[t],o=n.getId();if(!o)throw new Error("Invalid id for the layer: "+o);if(n.getEarth()!==this){if(this._layerCache[o])throw new Error("Duplicate layer id in the earth: "+o);this._layerCache[o]=n,n._bindEarth(this,this._layers.length),this._layers.push(n),this._loaded&&n.load()}}return this}},{key:"removeLayer",value:function(e){if(!e)return this;if(!Array.isArray(e))return this.removeLayer([e]);for(var t=[],i=0,n=e.length;i<n;i++){var o=e[i];if(o instanceof C||(o=this.getLayer(o)),o){var r=o.getEarth();if(r&&r===this){t.push(o);var a=o.getId();this._layerCache&&delete this._layerCache[a]}}}return this}},{key:"_load",value:function(){this._layers.forEach(function(e){return e.load()}),this._loaded=!0}}]),e}(),N=3.141592653589793,U={PI:N,PI2:6.283185307179586,HALFPI:1.5707963267948966,MAXPHI:1.2626272556789115,numerationSystemTo10:function(e,t){for(var i=0,n=0;n<t.length;n++){var o=t.length-1-n;i+=parseInt(t[n])*Math.pow(e,o)}return i}};A.prototype.setBearing=function(e){console.log(e)},A.prototype.getBearing=function(){return Math.round(100*this._controls.bearing)/100},A.prototype.setPitch=function(e){},A.prototype.getPitch=function(){return Math.round(100*this._controls.pitch)/100},A.prototype.setZoom=function(e){},A.prototype.getZoom=function(){return Math.round(10*(this._controls.maxZoom-this._controls.zoom))/10},A.prototype.setRadian=function(e){},A.prototype.getRadian=function(){var e=this._controls.coord.clone();return e.x+=U.HALFPI,e};var T={geoToSphere:function(e,i){var n=i[0]/180*U.PI+U.HALFPI;n>U.PI&&(n=-U.PI2+n);var o=(90-i[1])/180*U.PI,r=new t.Spherical(e,o,n);return r.makeSafe(),(new t.Vector3).setFromSpherical(r)}};e.Earth=A,e.Layer=C,e.MathUtils=U,e.GeoUtils=T,Object.defineProperty(e,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("geov.js 0.0.3")});